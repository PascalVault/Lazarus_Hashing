<?php
//CRC-24 OS-9
//Author: domasz
//Version: 0.1 (2022-11-19)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC24_OS9 extends HasherBase
{
	protected $FHash = 0;

    protected $Table = array(
	0x00000000, 0x00800063, 0x008000A5, 0x000000C6, 0x00800129, 0x0000014A, 0x0000018C, 0x008001EF, 
	0x00800231, 0x00000252, 0x00000294, 0x008002F7, 0x00000318, 0x0080037B, 0x008003BD, 0x000003DE, 
	0x00800401, 0x00000462, 0x000004A4, 0x008004C7, 0x00000528, 0x0080054B, 0x0080058D, 0x000005EE, 
	0x00000630, 0x00800653, 0x00800695, 0x000006F6, 0x00800719, 0x0000077A, 0x000007BC, 0x008007DF, 
	0x00800861, 0x00000802, 0x000008C4, 0x008008A7, 0x00000948, 0x0080092B, 0x008009ED, 0x0000098E, 
	0x00000A50, 0x00800A33, 0x00800AF5, 0x00000A96, 0x00800B79, 0x00000B1A, 0x00000BDC, 0x00800BBF, 
	0x00000C60, 0x00800C03, 0x00800CC5, 0x00000CA6, 0x00800D49, 0x00000D2A, 0x00000DEC, 0x00800D8F, 
	0x00800E51, 0x00000E32, 0x00000EF4, 0x00800E97, 0x00000F78, 0x00800F1B, 0x00800FDD, 0x00000FBE, 
	0x008010A1, 0x000010C2, 0x00001004, 0x00801067, 0x00001188, 0x008011EB, 0x0080112D, 0x0000114E, 
	0x00001290, 0x008012F3, 0x00801235, 0x00001256, 0x008013B9, 0x000013DA, 0x0000131C, 0x0080137F, 
	0x000014A0, 0x008014C3, 0x00801405, 0x00001466, 0x00801589, 0x000015EA, 0x0000152C, 0x0080154F, 
	0x00801691, 0x000016F2, 0x00001634, 0x00801657, 0x000017B8, 0x008017DB, 0x0080171D, 0x0000177E, 
	0x000018C0, 0x008018A3, 0x00801865, 0x00001806, 0x008019E9, 0x0000198A, 0x0000194C, 0x0080192F, 
	0x00801AF1, 0x00001A92, 0x00001A54, 0x00801A37, 0x00001BD8, 0x00801BBB, 0x00801B7D, 0x00001B1E, 
	0x00801CC1, 0x00001CA2, 0x00001C64, 0x00801C07, 0x00001DE8, 0x00801D8B, 0x00801D4D, 0x00001D2E, 
	0x00001EF0, 0x00801E93, 0x00801E55, 0x00001E36, 0x00801FD9, 0x00001FBA, 0x00001F7C, 0x00801F1F, 
	0x00802121, 0x00002142, 0x00002184, 0x008021E7, 0x00002008, 0x0080206B, 0x008020AD, 0x000020CE, 
	0x00002310, 0x00802373, 0x008023B5, 0x000023D6, 0x00802239, 0x0000225A, 0x0000229C, 0x008022FF, 
	0x00002520, 0x00802543, 0x00802585, 0x000025E6, 0x00802409, 0x0000246A, 0x000024AC, 0x008024CF, 
	0x00802711, 0x00002772, 0x000027B4, 0x008027D7, 0x00002638, 0x0080265B, 0x0080269D, 0x000026FE, 
	0x00002940, 0x00802923, 0x008029E5, 0x00002986, 0x00802869, 0x0000280A, 0x000028CC, 0x008028AF, 
	0x00802B71, 0x00002B12, 0x00002BD4, 0x00802BB7, 0x00002A58, 0x00802A3B, 0x00802AFD, 0x00002A9E, 
	0x00802D41, 0x00002D22, 0x00002DE4, 0x00802D87, 0x00002C68, 0x00802C0B, 0x00802CCD, 0x00002CAE, 
	0x00002F70, 0x00802F13, 0x00802FD5, 0x00002FB6, 0x00802E59, 0x00002E3A, 0x00002EFC, 0x00802E9F, 
	0x00003180, 0x008031E3, 0x00803125, 0x00003146, 0x008030A9, 0x000030CA, 0x0000300C, 0x0080306F, 
	0x008033B1, 0x000033D2, 0x00003314, 0x00803377, 0x00003298, 0x008032FB, 0x0080323D, 0x0000325E, 
	0x00803581, 0x000035E2, 0x00003524, 0x00803547, 0x000034A8, 0x008034CB, 0x0080340D, 0x0000346E, 
	0x000037B0, 0x008037D3, 0x00803715, 0x00003776, 0x00803699, 0x000036FA, 0x0000363C, 0x0080365F, 
	0x008039E1, 0x00003982, 0x00003944, 0x00803927, 0x000038C8, 0x008038AB, 0x0080386D, 0x0000380E, 
	0x00003BD0, 0x00803BB3, 0x00803B75, 0x00003B16, 0x00803AF9, 0x00003A9A, 0x00003A5C, 0x00803A3F, 
	0x00003DE0, 0x00803D83, 0x00803D45, 0x00003D26, 0x00803CC9, 0x00003CAA, 0x00003C6C, 0x00803C0F, 
	0x00803FD1, 0x00003FB2, 0x00003F74, 0x00803F17, 0x00003EF8, 0x00803E9B, 0x00803E5D, 0x00003E3E
	);


	public function __construct() 
	{
		$this->FHash =  0xFFFFFF;
		$this->Check = '200FA5';
	}

	public function Update($Msg, $Length)
	{
		for ($i=0; $i<$Length; $i++)
		{
			$Index = (ord($Msg[$i]) ^ ($this->FHash >> 16)) & 0xFF;
			$this->FHash = ($this->FHash << 8) ^ $this->Table[$Index];
		}
	}

	public function Finish()
	{
		$this->FHash = $this->FHash & 0xFFFFFF;
		$this->FHash = $this->FHash ^ 0xFFFFFF;  
		return sprintf('%04X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-24 OS-9', 'HasherCRC24_OS9');