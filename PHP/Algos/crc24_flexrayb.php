<?php
//CRC-24 FLEXRAY-B
//Author: domasz
//Version: 0.1 (2022-11-19)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC24_FLEXRAYB extends HasherBase
{
	protected $FHash = 0;

    protected $Table = array(
	0x00000000, 0x005D6DCB, 0x00BADB96, 0x00E7B65D, 0x0028DAE7, 0x0075B72C, 0x00920171, 0x00CF6CBA, 
	0x0051B5CE, 0x000CD805, 0x00EB6E58, 0x00B60393, 0x00796F29, 0x002402E2, 0x00C3B4BF, 0x009ED974, 
	0x00A36B9C, 0x00FE0657, 0x0019B00A, 0x0044DDC1, 0x008BB17B, 0x00D6DCB0, 0x00316AED, 0x006C0726, 
	0x00F2DE52, 0x00AFB399, 0x004805C4, 0x0015680F, 0x00DA04B5, 0x0087697E, 0x0060DF23, 0x003DB2E8, 
	0x001BBAF3, 0x0046D738, 0x00A16165, 0x00FC0CAE, 0x00336014, 0x006E0DDF, 0x0089BB82, 0x00D4D649, 
	0x004A0F3D, 0x001762F6, 0x00F0D4AB, 0x00ADB960, 0x0062D5DA, 0x003FB811, 0x00D80E4C, 0x00856387, 
	0x00B8D16F, 0x00E5BCA4, 0x00020AF9, 0x005F6732, 0x00900B88, 0x00CD6643, 0x002AD01E, 0x0077BDD5, 
	0x00E964A1, 0x00B4096A, 0x0053BF37, 0x000ED2FC, 0x00C1BE46, 0x009CD38D, 0x007B65D0, 0x0026081B, 
	0x003775E6, 0x006A182D, 0x008DAE70, 0x00D0C3BB, 0x001FAF01, 0x0042C2CA, 0x00A57497, 0x00F8195C, 
	0x0066C028, 0x003BADE3, 0x00DC1BBE, 0x00817675, 0x004E1ACF, 0x00137704, 0x00F4C159, 0x00A9AC92, 
	0x00941E7A, 0x00C973B1, 0x002EC5EC, 0x0073A827, 0x00BCC49D, 0x00E1A956, 0x00061F0B, 0x005B72C0, 
	0x00C5ABB4, 0x0098C67F, 0x007F7022, 0x00221DE9, 0x00ED7153, 0x00B01C98, 0x0057AAC5, 0x000AC70E, 
	0x002CCF15, 0x0071A2DE, 0x00961483, 0x00CB7948, 0x000415F2, 0x00597839, 0x00BECE64, 0x00E3A3AF, 
	0x007D7ADB, 0x00201710, 0x00C7A14D, 0x009ACC86, 0x0055A03C, 0x0008CDF7, 0x00EF7BAA, 0x00B21661, 
	0x008FA489, 0x00D2C942, 0x00357F1F, 0x006812D4, 0x00A77E6E, 0x00FA13A5, 0x001DA5F8, 0x0040C833, 
	0x00DE1147, 0x00837C8C, 0x0064CAD1, 0x0039A71A, 0x00F6CBA0, 0x00ABA66B, 0x004C1036, 0x00117DFD, 
	0x006EEBCC, 0x00338607, 0x00D4305A, 0x00895D91, 0x0046312B, 0x001B5CE0, 0x00FCEABD, 0x00A18776, 
	0x003F5E02, 0x006233C9, 0x00858594, 0x00D8E85F, 0x001784E5, 0x004AE92E, 0x00AD5F73, 0x00F032B8, 
	0x00CD8050, 0x0090ED9B, 0x00775BC6, 0x002A360D, 0x00E55AB7, 0x00B8377C, 0x005F8121, 0x0002ECEA, 
	0x009C359E, 0x00C15855, 0x0026EE08, 0x007B83C3, 0x00B4EF79, 0x00E982B2, 0x000E34EF, 0x00535924, 
	0x0075513F, 0x00283CF4, 0x00CF8AA9, 0x0092E762, 0x005D8BD8, 0x0000E613, 0x00E7504E, 0x00BA3D85, 
	0x0024E4F1, 0x0079893A, 0x009E3F67, 0x00C352AC, 0x000C3E16, 0x005153DD, 0x00B6E580, 0x00EB884B, 
	0x00D63AA3, 0x008B5768, 0x006CE135, 0x00318CFE, 0x00FEE044, 0x00A38D8F, 0x00443BD2, 0x00195619, 
	0x00878F6D, 0x00DAE2A6, 0x003D54FB, 0x00603930, 0x00AF558A, 0x00F23841, 0x00158E1C, 0x0048E3D7, 
	0x00599E2A, 0x0004F3E1, 0x00E345BC, 0x00BE2877, 0x007144CD, 0x002C2906, 0x00CB9F5B, 0x0096F290, 
	0x00082BE4, 0x0055462F, 0x00B2F072, 0x00EF9DB9, 0x0020F103, 0x007D9CC8, 0x009A2A95, 0x00C7475E, 
	0x00FAF5B6, 0x00A7987D, 0x00402E20, 0x001D43EB, 0x00D22F51, 0x008F429A, 0x0068F4C7, 0x0035990C, 
	0x00AB4078, 0x00F62DB3, 0x00119BEE, 0x004CF625, 0x00839A9F, 0x00DEF754, 0x00394109, 0x00642CC2, 
	0x004224D9, 0x001F4912, 0x00F8FF4F, 0x00A59284, 0x006AFE3E, 0x003793F5, 0x00D025A8, 0x008D4863, 
	0x00139117, 0x004EFCDC, 0x00A94A81, 0x00F4274A, 0x003B4BF0, 0x0066263B, 0x00819066, 0x00DCFDAD, 
	0x00E14F45, 0x00BC228E, 0x005B94D3, 0x0006F918, 0x00C995A2, 0x0094F869, 0x00734E34, 0x002E23FF, 
	0x00B0FA8B, 0x00ED9740, 0x000A211D, 0x00574CD6, 0x0098206C, 0x00C54DA7, 0x0022FBFA, 0x007F9631
	);


	public function __construct() 
	{
		$this->FHash =  0xABCDEF;
		$this->Check = '1F23B8';
	}

	public function Update($Msg, $Length)
	{
		for ($i=0; $i<$Length; $i++)
		{
			$Index = (ord($Msg[$i]) ^ ($this->FHash >> 16)) & 0xFF;
			$this->FHash = ($this->FHash << 8) ^ $this->Table[$Index];
		}
	}

	public function Finish()
	{
		$this->FHash = $this->FHash & 0xFFFFFF;    
		return sprintf('%04X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-24 FLEXRAY-B', 'HasherCRC24_FLEXRAYB');