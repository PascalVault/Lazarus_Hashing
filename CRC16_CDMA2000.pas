unit CRC16_CDMA2000;
//CRC-16 CDMA2000
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

interface

uses SysUtils, HasherBase;

type THasherCRC16_CDMA2000 = class(THasherBase)
  private
    FHash: Word;
  public
    constructor Create; override;
    procedure Update(Msg: PByte; Length: Integer); override;
    function Final: String; override;
end;

implementation

var Table: array[0..255] of Word = (
$00000000, $0000C867, $000058A9, $000090CE, $0000B152, $00007935, $0000E9FB, $0000219C, 
$0000AAC3, $000062A4, $0000F26A, $00003A0D, $00001B91, $0000D3F6, $00004338, $00008B5F, 
$00009DE1, $00005586, $0000C548, $00000D2F, $00002CB3, $0000E4D4, $0000741A, $0000BC7D, 
$00003722, $0000FF45, $00006F8B, $0000A7EC, $00008670, $00004E17, $0000DED9, $000016BE, 
$0000F3A5, $00003BC2, $0000AB0C, $0000636B, $000042F7, $00008A90, $00001A5E, $0000D239, 
$00005966, $00009101, $000001CF, $0000C9A8, $0000E834, $00002053, $0000B09D, $000078FA, 
$00006E44, $0000A623, $000036ED, $0000FE8A, $0000DF16, $00001771, $000087BF, $00004FD8, 
$0000C487, $00000CE0, $00009C2E, $00005449, $000075D5, $0000BDB2, $00002D7C, $0000E51B, 
$00002F2D, $0000E74A, $00007784, $0000BFE3, $00009E7F, $00005618, $0000C6D6, $00000EB1, 
$000085EE, $00004D89, $0000DD47, $00001520, $000034BC, $0000FCDB, $00006C15, $0000A472, 
$0000B2CC, $00007AAB, $0000EA65, $00002202, $0000039E, $0000CBF9, $00005B37, $00009350, 
$0000180F, $0000D068, $000040A6, $000088C1, $0000A95D, $0000613A, $0000F1F4, $00003993, 
$0000DC88, $000014EF, $00008421, $00004C46, $00006DDA, $0000A5BD, $00003573, $0000FD14, 
$0000764B, $0000BE2C, $00002EE2, $0000E685, $0000C719, $00000F7E, $00009FB0, $000057D7, 
$00004169, $0000890E, $000019C0, $0000D1A7, $0000F03B, $0000385C, $0000A892, $000060F5, 
$0000EBAA, $000023CD, $0000B303, $00007B64, $00005AF8, $0000929F, $00000251, $0000CA36, 
$00005E5A, $0000963D, $000006F3, $0000CE94, $0000EF08, $0000276F, $0000B7A1, $00007FC6, 
$0000F499, $00003CFE, $0000AC30, $00006457, $000045CB, $00008DAC, $00001D62, $0000D505, 
$0000C3BB, $00000BDC, $00009B12, $00005375, $000072E9, $0000BA8E, $00002A40, $0000E227, 
$00006978, $0000A11F, $000031D1, $0000F9B6, $0000D82A, $0000104D, $00008083, $000048E4, 
$0000ADFF, $00006598, $0000F556, $00003D31, $00001CAD, $0000D4CA, $00004404, $00008C63, 
$0000073C, $0000CF5B, $00005F95, $000097F2, $0000B66E, $00007E09, $0000EEC7, $000026A0, 
$0000301E, $0000F879, $000068B7, $0000A0D0, $0000814C, $0000492B, $0000D9E5, $00001182, 
$00009ADD, $000052BA, $0000C274, $00000A13, $00002B8F, $0000E3E8, $00007326, $0000BB41, 
$00007177, $0000B910, $000029DE, $0000E1B9, $0000C025, $00000842, $0000988C, $000050EB, 
$0000DBB4, $000013D3, $0000831D, $00004B7A, $00006AE6, $0000A281, $0000324F, $0000FA28, 
$0000EC96, $000024F1, $0000B43F, $00007C58, $00005DC4, $000095A3, $0000056D, $0000CD0A, 
$00004655, $00008E32, $00001EFC, $0000D69B, $0000F707, $00003F60, $0000AFAE, $000067C9, 
$000082D2, $00004AB5, $0000DA7B, $0000121C, $00003380, $0000FBE7, $00006B29, $0000A34E, 
$00002811, $0000E076, $000070B8, $0000B8DF, $00009943, $00005124, $0000C1EA, $0000098D, 
$00001F33, $0000D754, $0000479A, $00008FFD, $0000AE61, $00006606, $0000F6C8, $00003EAF, 
$0000B5F0, $00007D97, $0000ED59, $0000253E, $000004A2, $0000CCC5, $00005C0B, $0000946C
);

constructor THasherCRC16_CDMA2000.Create;
begin
  inherited Create;
  FHash :=  $FFFF;
  Check := '4C06';
end;

procedure THasherCRC16_CDMA2000.Update(Msg: PByte; Length: Integer);
var i: Integer;
begin
  for i:=0 to Length-1 do begin    	    
    FHash := (FHash shl 8) xor Table[((FHash shr 8) xor Msg^) and $FF];
    Inc(Msg);
  end;   
end;

function THasherCRC16_CDMA2000.Final: String;
begin
  
  Result := IntToHex(FHash, 4); 
end;

initialization
  HasherList.RegisterHasher('CRC-16 CDMA2000', THasherCRC16_CDMA2000);

end.
